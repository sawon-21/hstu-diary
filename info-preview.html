<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Review Pulse</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/remixicon@4.2.0/fonts/remixicon.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <link
    href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Amiri:wght@400;700&family=Hind+Siliguri:wght@400;600;700&display=swap"
    rel="stylesheet"
  />
  <style>
    :root {
      --dark-1: #0f0f13;
      --dark-2: #1a1a24;
      --dark-3: #252535;
      --accent-1: #ff6b6b;
      --accent-2: #48dbfb;
      --accent-3: #1dd1a1;
      --accent-4: #feca57;
      --text: #e0e0e8;
      --text-light: #a0a0b0;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background-color: var(--dark-1);
      color: var(--text);
      font-family: 'Poppins', sans-serif;
      min-height: 100vh;
      padding: 2rem 1rem;
      overflow-x: hidden;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    /* Header */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1.5rem;
      background-color: var(--dark-2);
      border-radius: 1rem;
      margin-bottom: 2rem;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .logo-icon {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      font-weight: 700;
      color: white;
      background-color: var(--accent-1);
      animation: pulse 2s infinite;
    }

    .logo-text h1 {
      font-size: 1.8rem;
      background: linear-gradient(to right, var(--accent-1), var(--accent-2));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }

    .logo-text p {
      font-size: 0.9rem;
      color: var(--text-light);
    }

    /* Stats Card */
    .stats-card {
      background-color: var(--dark-2);
      border-radius: 1rem;
      padding: 1.5rem;
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
      margin-bottom: 2rem;
    }

    .stats-title {
      font-size: 1.2rem;
      margin-bottom: 1.5rem;
      color: var(--accent-3);
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 1rem;
    }

    @media (max-width: 768px) {
      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    .stat-item {
      text-align: center;
      padding: 0.5rem;
    }

    .stat-value {
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 0.25rem;
      background: linear-gradient(to right, var(--accent-1), var(--accent-2));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }

    .stat-label {
      font-size: 0.8rem;
      color: var(--text-light);
    }

    /* Top Reviewer */
    .top-reviewer {
      background-color: var(--dark-2);
      border-radius: 1rem;
      padding: 1.5rem;
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
      margin-bottom: 2rem;
    }

    .top-reviewer-title {
      font-size: 1.2rem;
      margin-bottom: 1.5rem;
      color: var(--accent-4);
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .reviewer-profile {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .reviewer-avatar {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      color: white;
      flex-shrink: 0;
    }

    .reviewer-name {
      font-weight: 600;
      margin-bottom: 0.25rem;
    }

    .reviewer-stats {
      display: flex;
      gap: 1rem;
      font-size: 0.9rem;
      color: var(--text-light);
    }

    .reviewer-review {
      font-style: italic;
      margin-bottom: 1.5rem;
      line-height: 1.6;
    }

    .reviewer-rating {
      color: var(--accent-4);
    }

    /* Review Form */
    .review-form {
      background-color: var(--dark-2);
      border-radius: 1rem;
      padding: 2rem;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      margin-bottom: 2rem;
    }

    .form-title {
      font-size: 1.5rem;
      margin-bottom: 1.5rem;
      display: flex;
      align-items: center;
      gap: 0.75rem;
      color: var(--accent-2);
    }

    .form-group {
      margin-bottom: 1.5rem;
    }

    .form-label {
      display: block;
      margin-bottom: 0.5rem;
      color: var(--text-light);
      font-size: 0.9rem;
    }

    .form-control {
      width: 100%;
      padding: 0.8rem 1rem;
      background-color: var(--dark-3);
      border: 1px solid var(--dark-3);
      border-radius: 0.5rem;
      color: var(--text);
      font-family: 'Poppins', sans-serif;
      transition: all 0.3s ease;
    }

    .form-control:focus {
      outline: none;
      border-color: var(--accent-2);
      box-shadow: 0 0 0 3px rgba(72, 219, 251, 0.2);
    }

    textarea.form-control {
      min-height: 120px;
      resize: vertical;
    }

    .rating-selector {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1.5rem;
    }

    .rating-btn {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background-color: var(--dark-3);
      color: var(--text-light);
      border: none;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .rating-btn:hover {
      transform: translateY(-3px);
      background-color: var(--accent-4);
      color: var(--dark-1);
    }

    .rating-btn.active {
      background-color: var(--accent-4);
      color: var(--dark-1);
      transform: scale(1.1);
    }

    .btn {
      padding: 0.8rem 1.5rem;
      border-radius: 0.5rem;
      font-weight: 600;
      font-family: 'Poppins', sans-serif;
      cursor: pointer;
      transition: all 0.3s ease;
      border: none;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
    }

    .btn-primary {
      background: linear-gradient(to right, var(--accent-1), var(--accent-2));
      color: white;
      box-shadow: 0 5px 15px rgba(255, 107, 107, 0.3);
    }

    .btn-primary:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(255, 107, 107, 0.4);
    }

    /* Reviews List */
    .reviews-list {
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }

    .review-card {
      background-color: var(--dark-2);
      border-radius: 1rem;
      padding: 1.5rem;
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
      transition: all 0.3s ease;
    }

    .review-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    }

    .review-header {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1rem;
    }

    .review-avatar {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      color: white;
      flex-shrink: 0;
    }

    .review-info {
      flex-grow: 1;
    }

    .review-name {
      font-weight: 600;
      margin-bottom: 0.25rem;
    }

    .review-time {
      font-size: 0.8rem;
      color: var(--text-light);
    }

    .review-rating {
      color: var(--accent-4);
      font-size: 1rem;
    }

    .review-content {
      margin-bottom: 1.5rem;
      line-height: 1.6;
    }

    .review-actions {
      display: flex;
      gap: 0.75rem;
    }

    .action-btn {
      padding: 0.5rem 1rem;
      border-radius: 2rem;
      background-color: var(--dark-3);
      color: var(--text-light);
      font-size: 0.9rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      cursor: pointer;
      transition: all 0.3s ease;
      border: none;
    }

    .action-btn:hover {
      transform: translateY(-2px);
    }

    .action-btn.like.active {
      background-color: rgba(29, 209, 161, 0.2);
      color: var(--accent-3);
    }

    .action-btn.dislike.active {
      background-color: rgba(255, 107, 107, 0.2);
      color: var(--accent-1);
    }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 3rem;
      background-color: var(--dark-2);
      border-radius: 1rem;
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
    }

    .empty-icon {
      font-size: 3rem;
      margin-bottom: 1rem;
      color: var(--accent-2);
      animation: pulse 2s infinite;
    }

    .empty-title {
      font-size: 1.5rem;
      margin-bottom: 0.5rem;
      color: var(--text);
    }

    .empty-text {
      color: var(--text-light);
      margin-bottom: 1.5rem;
    }

    .info-button {
      display: inline-flex;
      align-items: center;
      cursor: pointer;
      padding: 10px;
      color: #fff;
     font-family: 'Hind Siliguri', sans-serif;
      border-radius: 50%;
      font-size: 1.5rem;
      transition: all 0.3s ease;
      background: none;
      border: none;
    }

    .info-button:hover {
      color: var(--accent-2);
    }

    .modal-content {
      background: var(--dark-2);
      color: var(--text);
      border-radius: 16px;
            font-family: 'Hind Siliguri', sans-serif;
      border: 1px solid var(--dark-3);
      animation: zoomIn 0.4s ease;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
    }

    .modal-header {
      border-bottom: 1px solid var(--dark-3);
      background: linear-gradient(90deg, var(--dark-2), var(--dark-1));
      padding: 1.5rem 2rem;
    }

    .modal-title {
      font-size: 1.9rem;
      font-weight: 700;
      color: var(--text);
      display: flex;
      align-items: center;
    }

    .modal-body {
      max-height: 70vh;
      overflow-y: auto;
      padding: 2rem;
      animation: slideInUp 0.5s ease;
      scrollbar-width: thin;
      scrollbar-color: var(--dark-3) var(--dark-1);
    }

    .modal-body::-webkit-scrollbar {
      width: 8px;
    }

    .modal-body::-webkit-scrollbar-track {
      background: var(--dark-1);
    }

    .modal-body::-webkit-scrollbar-thumb {
      background: var(--dark-3);
      border-radius: 4px;
    }

    .modal-footer {
      border-top: 1px solid var(--dark-3);
      padding: 1rem 2rem;
      background: var(--dark-2);
    }

    .section-title {
      margin-top: 2rem;
      margin-bottom: 1rem;
      font-size: 1.4rem;
      font-weight: 700;
      color: var(--accent-4);
      border-left: 4px solid var(--accent-4);
      padding-left: 10px;
    }

    .feature-list {
      list-style: none;
      padding: 0;
    }

    .feature-list li {
      display: flex;
      align-items: flex-start;
      margin-bottom: 1rem;
      font-size: 1rem;
    }

    .feature-list li i {
      color: var(--accent-3);
      margin-right: 10px;
      font-size: 1.2rem;
      margin-top: 4px;
    }

    .feedback-link {
      color: var(--accent-3);
      text-decoration: none;
      font-weight: 500;
      transition: color 0.3s ease;
    }

    .feedback-link:hover {
      color: var(--accent-2);
      text-decoration: underline;
    }

    @keyframes zoomIn {
      from {
        transform: scale(0.8);
        opacity: 0;
      }
      to {
        transform: scale(1);
        opacity: 1;
      }
    }

    @keyframes slideInUp {
      from {
        transform: translateY(40px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    /* Accessibility Enhancements */
    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      border: 0;
    }

    @media (max-width: 576px) {
      .modal-dialog {
        margin: 1rem;
      }
      .modal-title {
        font-size: 1.2rem;
      }
      .modal-body {
        padding: 1.5rem;
      }
    }

    /* Animations */
    @keyframes pulse {
      0% {
        transform: scale(1);
      }
      50% {
        transform: scale(1.05);
      }
      100% {
        transform: scale(1);
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <header class="header">
      <div class="logo">
        <div class="logo-icon">
          <button class="info-button" data-bs-toggle="modal" data-bs-target="#infoModal" aria-label="About Review Pulse">
            <i class="fas fa-circle-info"></i>
          </button>
        </div>
        <div class="logo-text">
          <h1>Review Pulse</h1>
          <p>☜ Explore full specifications</p>
        </div>
      </div>
    </header>
  <!-- Modal -->
  <div class="modal fade" id="infoModal" tabindex="-1" aria-labelledby="infoModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">
      <div class="modal-content shadow-lg">
        <div class="modal-header">
          <h5 class="modal-title" id="infoModalLabel">
            <i class="fas fa-book me-2 text-info"></i>
            HSTU Diary – HSTU ও SASTC এর সকল আপডেট এখানে
          </h5>
          <button
            type="button"
            class="btn-close btn-close-white"
            data-bs-dismiss="modal"
            aria-label="Close Modal"
          ></button>
        </div>
        <div class="modal-body">
          <section>
            <h5 class="section-title">
              <i class="fas fa-info-circle me-2"></i> HSTU Diary সম্পর্কে
            </h5>
            <p>
              <strong>HSTU Diary</strong> হলো একটি অত্যাধুনিক ওয়েব অ্যাপ্লিকেশন যা
              <strong>হাজী মুহাম্মদ দানেশ বিজ্ঞান ও প্রযুক্তি বিশ্ববিদ্যালয় (HSTU)</strong> এবং
              <strong>সরকারি শহীদ আকবর আলী বিজ্ঞান ও প্রযুক্তি কলেজ (SASTC)</strong> এর শিক্ষার্থী, শিক্ষক এবং প্রশাসনের জন্য সকল গুরুত্বপূর্ণ তথ্য ও আপডেট একত্রিত করে। এই প্ল্যাটফর্মটি শিক্ষার্থীদের দৈনন্দিন একাডেমিক কার্যক্রম সহজতর করতে এবং তথ্যের দ্রুত প্রবাহ নিশ্চিত করতে ডিজাইন করা হয়েছে।
            </p>
            <p>
              আমাদের লক্ষ্য হলো একটি সুবিধাজনক এবং ব্যবহারকারী-বান্ধব প্ল্যাটফর্ম প্রদান করা যেখানে শিক্ষার্থীরা তাদের প্রয়োজনীয় তথ্য, রিসোর্স এবং নোটিশ এক ক্লিকেই পেতে পারেন।
            </p>
          </section>

          <section>
            <h5 class="section-title">
              <i class="fas fa-book me-2"></i> ফাইনাল রিপোর্ট: অ্যাপের সেকশনসমূহ
            </h5>
            <p>আমাদের অ্যাপে তথ্যগুলো সুসংগঠিতভাবে উপস্থাপনের জন্য নিম্নলিখিত সেকশনগুলো রয়েছে:</p>
            <ul class="feature-list">
              <li>
                <i class="fas fa-list"></i>
                <div>
                  <strong>All</strong>: সকল ধরনের আপডেট এবং তথ্য এক জায়গায়।
                </div>
              </li>
              <li>
                <i class="fas fa-chalkboard-teacher"></i>
                <div>
                  <strong>Class</strong>: ক্লাসের সময়সূচি, রুটিন এবং আপডেট।
                </div>
              </li>
              <li>
                <i class="fas fa-bell"></i>
                <div>
                  <strong>Notice</strong>: বিশ্ববিদ্যালয় ও কলেজের অফিসিয়াল নোটিশ।
                </div>
              </li>
              <li>
                <i class="fas fa-exclamation-circle"></i>
                <div>
                  <strong>Important</strong>: জরুরি ঘোষণা এবং তথ্য।
                </div>
              </li>
              <li>
                <i class="fas fa-book-open"></i>
                <div>
                  <strong>Resources</strong>: CSE বিভাগের জন্য বই, ভিডিও, PDF, নোটস এবং অন্যান্য শিক্ষা উপকরণ।
                </div>
              </li>
              <li>
                <i class="fas fa-file-alt"></i>
                <div>
                  <strong>Exam</strong>: ক্লাস টেস্ট, মিড-টার্ম এবং ফাইনাল পরীক্ষার সময়সূচি ও আপডেট।
                </div>
              </li>
              <li>
                <i class="fas fa-tasks"></i>
                <div>
                  <strong>Assignment</strong>: অ্যাসাইনমেন্টের তথ্য এবং গাইডলাইন।
                </div>
              </li>
              <li>
                <i class="fas fa-sync-alt"></i>
                <div>
                  <strong>Update</strong>: সাধারণ আপডেট এবং ঘোষণা।
                </div>
              </li>
              <li>
                <i class="fas fa-calendar-alt"></i>
                <div>
                  <strong>Event</strong>: বিশ্ববিদ্যালয় ও কলেজের ইভেন্ট এবং প্রোগ্রাম।
                </div>
              </li>
              <li>
                <i class="fas fa-lightbulb"></i>
                <div>
                  <strong>Tips</strong>: শিক্ষার্থীদের জন্য শিক্ষাগত ও ক্যারিয়ার-সম্পর্কিত টিপস।
                </div>
              </li>
              <li>
                <i class="fas fa-globe"></i>
                <div>
                  <strong>World</strong>: বিশ্বব্যাপী প্রযুক্তি এবং বিজ্ঞানের খবর।
                </div>
              </li>
              <li>
                <i class="fas fa-newspaper"></i>
                <div>
                  <strong>News</strong>: সাম্প্রতিক টেক এবং শিক্ষা-সংক্রান্ত খবর।
                </div>
              </li>
            </ul>
          </section>
          <section>
            <h5 class="section-title">
              <i class="fas fa-users me-2"></i> আমাদের লক্ষ্য
            </h5>
            <p>
              আমরা HSTU এবং SASTC এর শিক্ষার্থীদের জন্য একটি সুবিধাজনক এবং আধুনিক প্ল্যাটফর্ম তৈরি করতে প্রতিশ্রুতিবদ্ধ। আমাদের অ্যাপটি শিক্ষার্থীদের সময় বাঁচাতে, তথ্যের অ্যাক্সেস সহজ করতে এবং একাডেমিক সাফল্য নিশ্চিত করতে ডিজাইন করা হয়েছে।
            </p>
          </section>
        </div>
        <div class="modal-footer ">
          <button type="button" class="btn btn-info" data-bs-dismiss="modal">
            বন্ধ করুন
          </button>
        </div>
      </div>
    </div>
  </div>
    <!-- Stats Card -->
    <div class="stats-card">
      <h3 class="stats-title">
        <i class="ri-line-chart-line"></i> Review Stats
      </h3>
      <div class="stats-grid">
        <div class="stat-item">
          <div id="avgRating" class="stat-value">0.0</div>
          <div class="stat-label">Avg Rating</div>
        </div>
        <div class="stat-item">
          <div id="totalReviews" class="stat-value">0</div>
          <div class="stat-label">Total Reviews</div>
        </div>
        <div class="stat-item">
          <div id="positivePercent" class="stat-value">0%</div>
          <div class="stat-label">Positive</div>
        </div>
        <div class="stat-item">
          <div id="criticalPercent" class="stat-value">0%</div>
          <div class="stat-label">Critical</div>
        </div>
      </div>
    </div>

    <!-- Top Reviewer -->
    <div class="top-reviewer" id="topReviewerCard">
      <h3 class="top-reviewer-title">
        <i class="ri-medal-line"></i> Top Reviewer
      </h3>
      <div class="reviewer-profile">
        <div id="bestReviewerAvatar" class="reviewer-avatar">?</div>
        <div class="reviewer-info">
          <div id="bestReviewerName" class="reviewer-name">No reviews yet</div>
          <div class="reviewer-stats">
            <span><i class="ri-thumb-up-line"></i> <span id="bestReviewerLikes">0</span></span>
            <span><i class="ri-thumb-down-line"></i> <span id="bestReviewerDislikes">0</span></span>
          </div>
        </div>
      </div>
      <div class="reviewer-review">
        <span id="bestReviewerReview">Be the first to share a review!</span>
      </div>
      <div id="bestReviewerRating" class="reviewer-rating"></div>
    </div>

    <!-- Review Form -->
    <div class="review-form">
      <h2 class="form-title">
        <i class="ri-pencil-line"></i> Write a Review
      </h2>
      <div class="form-group">
        <label for="nameInput" class="form-label">Your Name</label>
        <input type="text" id="nameInput" class="form-control" placeholder="Anonymous">
      </div>
      <div class="form-group">
        <label class="form-label">Rating</label>
        <div class="rating-selector">
          <button class="rating-btn" data-rating="1" aria-label="Rate 1 star">1</button>
          <button class="rating-btn" data-rating="2" aria-label="Rate 2 stars">2</button>
          <button class="rating-btn" data-rating="3" aria-label="Rate 3 stars">3</button>
          <button class="rating-btn" data-rating="4" aria-label="Rate 4 stars">4</button>
          <button class="rating-btn" data-rating="5" aria-label="Rate 5 stars">5</button>
        </div>
      </div>
      <div class="form-group">
        <label for="messageInput" class="form-label">Your Review</label>
        <textarea id="messageInput" class="form-control" placeholder="Share your experience..."></textarea>
      </div>
      <button id="postBtn" class="btn btn-primary">
        <i class="ri-send-plane-line"></i> Submit Review
      </button>
    </div>

    <!-- Reviews List -->
    <div class="reviews-list" id="reviewsArea">
      <!-- Reviews will be inserted here by JavaScript -->
    </div>
  </div>

  <!-- Firebase (modular) -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import { getDatabase, ref, push, set, onValue, runTransaction } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyDVwk1f4VHfXF2XDTeN60OCi3X6wHe10EE",
      authDomain: "exam-19f65.firebaseapp.com",
      databaseURL: "https://exam-19f65-default-rtdb.firebaseio.com",
      projectId: "exam-19f65",
      storageBucket: "exam-19f65.appspot.com",
      messagingSenderId: "109519694600",
      appId: "1:109519694600:web:d96202a424b5a6db295abd",
      measurementId: "G-960R79WSZ9"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const reviewsRef = ref(db, 'reviews');

    // User ID and name management
    let userId = localStorage.getItem('reviewpulse_uid') || `user_${Math.random().toString(36).slice(2, 10)}`;
    localStorage.setItem('reviewpulse_uid', userId);
    
    // Load saved name if exists
    const savedName = localStorage.getItem('reviewpulse_username');
    if (savedName) {
      document.getElementById('nameInput').value = savedName;
    }

    // DOM elements
    const $ = (id) => document.getElementById(id);
    const nameInput = $('nameInput');
    const messageInput = $('messageInput');
    const postBtn = $('postBtn');
    const reviewsArea = $('reviewsArea');
    const ratingButtons = document.querySelectorAll('.rating-btn');
    const avgRatingEl = $('avgRating');
    const totalReviewsEl = $('totalReviews');
    const positivePercentEl = $('positivePercent');
    const criticalPercentEl = $('criticalPercent');
    const bestReviewerAvatar = $('bestReviewerAvatar');
    const bestReviewerName = $('bestReviewerName');
    const bestReviewerReview = $('bestReviewerReview');
    const bestReviewerRating = $('bestReviewerRating');
    const bestReviewerLikes = $('bestReviewerLikes');
    const bestReviewerDislikes = $('bestReviewerDislikes');

    // Color palette for avatars
    const avatarColors = [
      '#FF6B6B', '#48DBFB', '#1DD1A1', '#FECA57', 
      '#FF9FF3', '#FECA57', '#FF9F43', '#EE5253', 
      '#0ABDE3', '#10AC84', '#5F27CD', '#54A0FF'
    ];

    // Generate random color for avatar based on name hash
    const getAvatarColor = (name) => {
      if (!name) return avatarColors[0];
      let hash = 0;
      for (let i = 0; i < name.length; i++) {
        hash = name.charCodeAt(i) + ((hash << 5) - hash);
      }
      return avatarColors[Math.abs(hash) % avatarColors.length];
    };

    // Rating selection
    ratingButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        ratingButtons.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
      });
    });

    // Get initials from name
    const getInitials = (name) => {
      if (!name) return 'A';
      return name.split(' ').map(x => x.charAt(0)).join('').slice(0, 2).toUpperCase();
    };

    // Analyze sentiment (mock function)
    const analyzeSentiment = (text) => {
      if (!text) return 'neutral';
      const positiveWords = ['great', 'excellent', 'amazing', 'love', 'good', 'perfect', 'happy', 'wonderful', 'awesome'];
      const negativeWords = ['bad', 'terrible', 'awful', 'hate', 'poor', 'disappointed', 'worst', 'frustrating'];
      
      const lowerText = text.toLowerCase();
      const positiveCount = positiveWords.filter(w => lowerText.includes(w)).length;
      const negativeCount = negativeWords.filter(w => lowerText.includes(w)).length;
      
      if (positiveCount > negativeCount) return 'positive';
      if (negativeCount > positiveCount) return 'negative';
      return 'neutral';
    };

    // Format date
    const formatDate = (timestamp) => {
      const now = new Date();
      const reviewDate = new Date(timestamp);
      const diff = now - reviewDate;
      const minutes = Math.floor(diff / (1000 * 60));
      const hours = Math.floor(diff / (1000 * 60 * 60));
      const days = Math.floor(diff / (1000 * 60 * 60 * 24));

      if (minutes < 1) return 'just now';
      if (minutes < 60) return `${minutes} min ago`;
      if (hours < 24) return `${hours} hour${hours === 1 ? '' : 's'} ago`;
      if (days < 7) return `${days} day${days === 1 ? '' : 's'} ago`;
      return reviewDate.toLocaleDateString();
    };

    // Post review
    postBtn.addEventListener('click', async () => {
      let name = nameInput.value.trim() || 'Anonymous';
      
      // Save name to localStorage if not anonymous
      if (name !== 'Anonymous') {
        localStorage.setItem('reviewpulse_username', name);
      }

      const rating = document.querySelector('.rating-btn.active')?.dataset.rating || 0;
      const message = messageInput.value.trim();

      if (!message) {
        alert('Please write your review before posting.');
        return;
      }

      if (rating === "0") {
        alert('Please select a rating before posting.');
        return;
      }

      try {
        const r = push(reviewsRef);
        await set(r, {
          name,
          rating: Number(rating),
          message,
          sentiment: analyzeSentiment(message),
          createdAt: Date.now(),
          likes: 0,
          dislikes: 0,
          reactions: {},
          helpfulCount: 0
        });
        messageInput.value = '';
        ratingButtons.forEach(b => b.classList.remove('active'));
      } catch (err) {
        console.error('Failed to post review:', err);
        alert('Failed to post review. Please try again.');
      }
    });

    // Real-time listener
    onValue(reviewsRef, (snap) => {
      const val = snap.val() || {};
      const items = Object.entries(val)
        .map(([id, data]) => ({ 
          id, 
          ...data, 
          totalReactions: (data.likes || 0) + (data.dislikes || 0),
          helpfulScore: (data.helpfulCount || 0) * 2 + (data.likes || 0) - (data.dislikes || 0)
        }))
        .sort((a, b) => b.createdAt - a.createdAt);

      renderList(items);
      updateStats(items);
      updateTopReviewer(items);
    });

    // Render reviews
    function renderList(items) {
      if (items.length === 0) {
        reviewsArea.innerHTML = `
          <div class="empty-state">
            <div class="empty-icon">
              <i class="ri-discuss-line"></i>
            </div>
            <h3 class="empty-title">No Reviews Yet</h3>
            <p class="empty-text">
              Be the first to share your feedback and help others make better decisions.
            </p>
          </div>
        `;
        return;
      }

      reviewsArea.innerHTML = '';
      items.forEach(item => {
        const myReaction = item.reactions?.[userId];
        const card = document.createElement('div');
        card.className = 'review-card';
        const initials = getInitials(item.name);
        const timeAgo = formatDate(item.createdAt);
        const avatarColor = getAvatarColor(item.name);

        card.innerHTML = `
          <div class="review-header">
            <div class="review-avatar" style="background-color: ${avatarColor}">${initials}</div>
            <div class="review-info">
              <div class="review-name">${item.name}</div>
              <div class="review-time">${timeAgo}</div>
            </div>
            <div class="review-rating">
              ${'★'.repeat(item.rating || 0)}${'☆'.repeat(5 - (item.rating || 0))}
            </div>
          </div>
          <div class="review-content">
            ${item.message}
          </div>
          <div class="review-actions">
            <button class="action-btn like ${myReaction === 'like' ? 'active' : ''}" data-id="${item.id}" data-action="like" aria-label="Like this review">
              <i class="ri-thumb-up-line"></i> ${item.likes || 0}
            </button>
            <button class="action-btn dislike ${myReaction === 'dislike' ? 'active' : ''}" data-id="${item.id}" data-action="dislike" aria-label="Dislike this review">
              <i class="ri-thumb-down-line"></i> ${item.dislikes || 0}
            </button>
          </div>
        `;
        
        // Add event listeners
        card.querySelector('.like').addEventListener('click', () => toggleReaction(item.id, 'like'));
        card.querySelector('.dislike').addEventListener('click', () => toggleReaction(item.id, 'dislike'));
        
        reviewsArea.appendChild(card);
      });
    }

    // Update stats
    function updateStats(items) {
      if (items.length === 0) {
        avgRatingEl.textContent = '0.0';
        totalReviewsEl.textContent = '0';
        positivePercentEl.textContent = '0%';
        criticalPercentEl.textContent = '0%';
        return;
      }

      // Calculate average rating
      const totalRating = items.reduce((sum, item) => sum + (item.rating || 0), 0);
      const avgRating = (totalRating / items.length).toFixed(1);
      avgRatingEl.textContent = avgRating;

      // Total reviews
      totalReviewsEl.textContent = items.length;

      // Sentiment percentages
      const positiveCount = items.filter(item => item.sentiment === 'positive').length;
      const negativeCount = items.filter(item => item.sentiment === 'negative').length;
      const positivePercent = Math.round((positiveCount / items.length) * 100);
      const criticalPercent = Math.round((negativeCount / items.length) * 100);

      positivePercentEl.textContent = `${positivePercent}%`;
      criticalPercentEl.textContent = `${criticalPercent}%`;
    }

    // Update top reviewer
    function updateTopReviewer(items) {
      if (items.length === 0) {
        bestReviewerName.textContent = 'No reviews yet';
        bestReviewerReview.textContent = 'Be the first to share a review!';
        bestReviewerRating.textContent = '';
        bestReviewerLikes.textContent = '0';
        bestReviewerDislikes.textContent = '0';
        bestReviewerAvatar.textContent = '?';
        bestReviewerAvatar.style.backgroundColor = avatarColors[0];
        return;
      }

      // Find the review with most reactions
      const bestReview = [...items].sort((a, b) => b.totalReactions - a.totalReactions)[0];
      const initials = getInitials(bestReview.name);
      const avatarColor = getAvatarColor(bestReview.name);

      bestReviewerAvatar.textContent = initials;
      bestReviewerAvatar.style.backgroundColor = avatarColor;
      bestReviewerName.textContent = bestReview.name;
      bestReviewerReview.textContent = bestReview.message;
      bestReviewerRating.textContent = '★'.repeat(bestReview.rating || 0) + '☆'.repeat(5 - (bestReview.rating || 0));
      bestReviewerLikes.textContent = bestReview.likes || 0;
      bestReviewerDislikes.textContent = bestReview.dislikes || 0;
    }

    // Toggle reaction
    async function toggleReaction(reviewId, action) {
      const nodeRef = ref(db, `reviews/${reviewId}`);
      try {
        await runTransaction(nodeRef, (current) => {
          if (!current) return;
          current.likes = current.likes || 0;
          current.dislikes = current.dislikes || 0;
          current.reactions = current.reactions || {};
          const prev = current.reactions[userId];

          if (prev === action) {
            delete current.reactions[userId];
            current[action === 'like' ? 'likes' : 'dislikes'] = Math.max(0, current[action === 'like' ? 'likes' : 'dislikes'] - 1);
          } else {
            if (prev === 'like') current.likes = Math.max(0, current.likes - 1);
            else if (prev === 'dislike') current.dislikes = Math.max(0, current.dislikes - 1);
            current.reactions[userId] = action;
            current[action === 'like' ? 'likes' : 'dislikes'] += 1;
          }
          return current;
        });
      } catch (err) {
        console.error('Reaction failed:', err);
      }
    }
  </script>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
</body>
</html>